% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/biomarker_plots.R
\name{find_inflection}
\alias{find_inflection}
\title{Find Inflection Point in Biomarker-Risk Relationship}
\usage{
find_inflection(risk_data, log_transform = FALSE)
}
\arguments{
\item{risk_data}{A data frame containing biomarker-risk data with the following columns:
\itemize{
\item \code{biomarker_midpoint} - Numeric vector of biomarker values
\item \code{risk_estimate} - Numeric vector of corresponding risk estimates (\%)
}
This data frame is typically obtained from \code{\link{plot_biomarker_risk_continuum}}
by extracting the \code{$data} element from the returned ggplot object.}

\item{log_transform}{Logical; if \code{TRUE}, applies log10 transformation to biomarker
values before analysis. Recommended for biomarkers with wide ranges or log-normal
distributions (e.g., NTproBNP, troponin). Default is \code{FALSE}.}
}
\value{
A list with two elements:
\describe{
\item{inflection_point}{Numeric value indicating the biomarker level at which
the rate of risk increase changes most dramatically (in original biomarker units)}
\item{model}{The fitted \code{smooth.spline} object, which can be used for
further analysis or plotting}
}
}
\description{
Identifies the inflection point in a biomarker-risk continuum by fitting a smoothing spline
and finding the point of maximum absolute curvature (second derivative).
}
\details{
The function identifies inflection points using the following approach:
\enumerate{
\item Optionally log-transforms the biomarker values
\item Fits a smoothing spline with 6 degrees of freedom
\item Calculates the second derivative numerically across 200 points
\item Identifies the point of maximum absolute curvature
\item Back-transforms to original biomarker scale if needed
}

This method is particularly useful for identifying clinical thresholds where biomarker-risk
relationships transition from gradual to steep increases, which may have implications for
risk stratification and treatment decisions.
}
\examples{
# Example 1: Basic usage with NTproBNP data
# First, generate risk data from plot_biomarker_risk_continuum
p1 <- plot_biomarker_risk_continuum(
  data = my_data,
  biomarker_col = "ntprobnp",
  target_age = 55,
  max_age = 90,
  n_bins = 40,
  log_transform = TRUE,
  smooth_line = TRUE
)

# Extract the plotted data
risk_data <- p1$data

# Find inflection point
result <- find_inflection(risk_data, log_transform = TRUE)
print(paste("Inflection at:", round(result$inflection_point, 1), "pg/mL"))

# Add inflection line to plot
p1 + geom_vline(xintercept = result$inflection_point,
                linetype = "dashed", color = "red", linewidth = 1)

# Example 2: Without log transformation (for normally distributed biomarkers)
p2 <- plot_biomarker_risk_continuum(
  data = my_data,
  biomarker_col = "cholesterol",
  target_age = 50,
  n_bins = 30
)

result2 <- find_inflection(p2$data, log_transform = FALSE)
print(result2$inflection_point)

# Example 3: Compare inflection points across age groups
ages <- c(45, 55, 65, 75)
inflections <- sapply(ages, function(age) {
  p <- plot_biomarker_risk_continuum(my_data, "ntprobnp",
                                     target_age = age, n_bins = 40,
                                     log_transform = TRUE)
  result <- find_inflection(p$data, log_transform = TRUE)
  result$inflection_point
})
names(inflections) <- paste0("Age_", ages)
print(inflections)

}
\seealso{
\code{\link{plot_biomarker_risk_continuum}} for generating the input risk data
}
